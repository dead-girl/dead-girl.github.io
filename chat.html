<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat • dead_chat</title>
  <link rel="stylesheet" href="./assets/style.css" />

  <style>
    .chat-wrap{ display:grid; gap:14px; }

    .chat-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      border-bottom:1px solid rgba(255,255,255,.10);
      padding-bottom:12px;
      margin-bottom:12px;
    }

    .chat-title{
      margin:0;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.80);
      text-transform: uppercase;
      letter-spacing: .6px;
    }

    .pillbar{ display:flex; gap:8px; flex-wrap:wrap; }
    .pill{
      font-family: var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
    }

    .frame{
      width:100%;
      height:72vh;
      min-height:520px;
      border:0;
      border-radius:18px;
      background: rgba(0,0,0,.22);
    }

    .hint{
      margin-top:10px;
      font-family: var(--mono);
      font-size:12px;
      color: rgba(255,255,255,.70);
      line-height:1.6;
    }
    .hint a{
      text-decoration:none;
      border-bottom:1px dotted rgba(255,255,255,.28);
    }
    .hint a:hover{ border-bottom-color: rgba(94,231,255,.70); }
  </style>
</head>

<body data-page="chatnow">
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="./index.html" aria-label="Go to Home">
        <img class="logo-img" src="./assets/deadchat_logo_transparent_small.png" alt="DEADCHAT" />
        <div>
          <div class="site-name">dead_chat</div>
          <div class="site-tag">same nick • joined rooms</div>
        </div>
      </a>

      <nav class="nav" aria-label="Site navigation">
        <a href="./index.html" data-page="home">Home</a>
        <a href="./chatrooms.html" data-page="chatrooms">Chatrooms</a>
        <a href="./chatters.html" data-page="chatters">Chatters</a>
        <a href="./chat-now.html" data-page="chatnow">Chat Now →</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <div class="container chat-wrap">
      <section class="card">
        <div class="chat-top">
          <div>
            <p class="chat-title">You joined:</p>
            <div class="pillbar" id="pillbar"></div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn" href="./chat-now.html">Change rooms</a>
            <a class="btn" id="openNewTab" href="#" target="_blank" rel="noopener">Open chat in new tab</a>
          </div>
        </div>

        <iframe class="frame" id="chatframe" title="Atrum webchat"></iframe>

        <div class="hint">
          Switch rooms using the channel list inside chat. If anything glitches, use “Open chat in new tab”.
        </div>
      </section>
    </div>
  </main>

  <script src="./assets/site.js"></script>
  <script>
    (function () {
      var ALLOWED = {
        "#truth": true,
        "#corinthians": true,
        "#cyber": true,
        "#chaos": true
      };

      function normaliseRoom(raw) {
        var r = (raw || "").trim();
        if (!r) return null;
        if (r.charAt(0) !== "#") r = "#" + r;
        var key = r.toLowerCase();
        if (!ALLOWED[key]) return null;

        if (key === "#corinthians") return "#Corinthians";
        return key; // #truth #cyber #chaos
      }

      function parseRoomsParam() {
        var params = new URLSearchParams(window.location.search || "");
        var raw = params.get("rooms") || "";
        var parts = raw.split(",");
        var out = [];
        var seen = {};
        for (var i = 0; i < parts.length; i++) {
          var r = normaliseRoom(parts[i]);
          if (r && !seen[r.toLowerCase()]) {
            seen[r.toLowerCase()] = true;
            out.push(r);
          }
        }
        if (!out.length) out = ["#truth"];
        return out;
      }

      var rooms = parseRoomsParam();

      var pillbar = document.getElementById("pillbar");
      for (var i = 0; i < rooms.length; i++) {
        var div = document.createElement("div");
        div.className = "pill";
        div.textContent = rooms[i];
        pillbar.appendChild(div);
      }

      var joinedPath = rooms.join(",");
      document.getElementById("chatframe").src = "https://webchat.atrum.org/" + joinedPath;
      document.getElementById("openNewTab").href = "https://webchat.atrum.org/" + joinedPath;
    })();
  </script>
</body>
</html>
